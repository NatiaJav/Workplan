<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhD Project Management System</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --white: #ffffff;
            --gray: #95a5a6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            background: white;
            padding: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            overflow-x: auto;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray);
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            color: var(--primary);
            background: #f8f9fa;
        }
        
        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Controls Bar */
        .controls-bar {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .control-group label {
            font-weight: 600;
            color: #666;
        }
        
        input[type="text"],
        input[type="date"],
        input[type="url"],
        select,
        textarea {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="url"]:focus,
        select:focus,
            textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        button {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-secondary {
            background: var(--gray);
            color: white;
        }
        
        /* Dashboard Summary */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Timeline View */
        .timeline-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .timeline-header {
            display: grid;
            grid-template-columns: 150px repeat(14, 100px);
            gap: 10px;
            font-weight: 600;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 1rem;
        }
        
        .timeline-row {
            display: grid;
            grid-template-columns: 150px repeat(14, 100px);
            gap: 10px;
            padding: 0.5rem 0;
            align-items: center;
        }
        
        .timeline-cell {
            text-align: center;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .timeline-active {
            background: var(--primary);
            color: white;
        }
        
        .timeline-completed {
            background: var(--success);
            color: white;
        }
        
        /* Task Cards */
        .task-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .task-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            flex: 1;
        }
        
        .task-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-project {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-priority-high {
            background: #ffebee;
            color: var(--danger);
        }
        
        .badge-priority-medium {
            background: #fff3e0;
            color: var(--warning);
        }
        
        .badge-priority-low {
            background: #e8f5e9;
            color: var(--success);
        }
        
        .status-badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .status-badge:hover {
            transform: scale(1.05);
        }
        
        .status-not-started {
            background: var(--danger);
            color: white;
        }
        
        .status-in-progress {
            background: var(--warning);
            color: white;
        }
        
        .status-completed {
            background: var(--success);
            color: white;
        }
        
        /* Subtasks */
        .subtasks-container {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
        }
        
        .subtask-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }
        
        .subtask-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .subtask-text {
            flex: 1;
        }
        
        .subtask-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        /* Reading List */
        .reading-item {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 1rem;
            align-items: start;
        }
        
        .reading-status {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
        }
        
        .reading-content {
            flex: 1;
        }
        
        .reading-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .reading-meta {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #666;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Editable Elements */
        .editable {
            cursor: text;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .editable:hover {
            background: #fffbf0;
            box-shadow: 0 0 0 2px #ffc107;
        }
        
        .editable:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 2px var(--primary);
        }
        
        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs {
                overflow-x: scroll;
            }
            
            .controls-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                width: 100%;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .timeline-container {
                overflow-x: scroll;
            }
        }
        
        /* Search Results */
        .search-highlight {
            background: yellow;
            padding: 2px;
            border-radius: 2px;
        }
        
        /* Export/Import Section */
        .data-management {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* Calendar View */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e0e0;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .calendar-cell {
            background: white;
            padding: 0.5rem;
            min-height: 80px;
            font-size: 0.8rem;
        }
        
        .calendar-header {
            background: var(--dark);
            color: white;
            padding: 0.5rem;
            text-align: center;
            font-weight: 600;
        }
        
        .calendar-day {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .calendar-task {
            background: #e3f2fd;
            padding: 2px 4px;
            border-radius: 3px;
            margin: 2px 0;
            font-size: 0.7rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📚 PhD Project Management System</h1>
        <p>Complete Academic Project Tracker</p>
    </div>
    
    <nav class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('dashboard')">📊 Dashboard</button>
        <button class="nav-tab" onclick="switchTab('tasks')">✓ Tasks</button>
        <button class="nav-tab" onclick="switchTab('timeline')">📅 Timeline</button>
        <button class="nav-tab" onclick="switchTab('reading')">📖 Reading List</button>
        <button class="nav-tab" onclick="switchTab('projects')">📁 Projects</button>
        <button class="nav-tab" onclick="switchTab('calendar')">🗓️ Calendar</button>
        <button class="nav-tab" onclick="switchTab('settings')">⚙️ Settings</button>
    </nav>
    
    <!-- Dashboard Tab -->
    <div id="dashboard-tab" class="tab-content active">
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-label">Total Tasks</div>
                <div class="stat-value" id="stat-total">0</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-total" style="width: 0%"></div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">This Week</div>
                <div class="stat-value" id="stat-week">0</div>
                <div class="stat-label" style="margin-top: 0.5rem">Due Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Reading Progress</div>
                <div class="stat-value" id="stat-reading">0</div>
                <div class="stat-label" style="margin-top: 0.5rem">Papers Read</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Projects</div>
                <div class="stat-value" id="stat-projects">0</div>
                <div class="stat-label" style="margin-top: 0.5rem">In Progress</div>
            </div>
        </div>
        
        <div class="task-card">
            <h3>Quick Overview</h3>
            <div id="dashboard-overview"></div>
        </div>
    </div>
    
    <!-- Tasks Tab -->
    <div id="tasks-tab" class="tab-content">
        <div class="controls-bar">
            <div class="control-group">
                <input type="text" id="search-tasks" placeholder="Search tasks..." style="width: 300px;">
            </div>
            <div class="control-group">
                <label>Project:</label>
                <select id="filter-project">
                    <option value="all">All Projects</option>
                </select>
            </div>
            <div class="control-group">
                <label>Status:</label>
                <select id="filter-status">
                    <option value="all">All Statuses</option>
                    <option value="not-started">Not Started</option>
                    <option value="in-progress">In Progress</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
            <div class="control-group">
                <label>Priority:</label>
                <select id="filter-priority">
                    <option value="all">All Priorities</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
            </div>
            <button class="btn-primary" onclick="showAddTaskModal()">+ Add Task</button>
            <button class="btn-secondary" onclick="resetFilters()">Reset Filters</button>
        </div>
        
        <div id="tasks-container"></div>
    </div>
    
    <!-- Timeline Tab -->
    <div id="timeline-tab" class="tab-content">
        <div class="controls-bar">
            <div class="control-group">
                <label>View:</label>
                <select id="timeline-view">
                    <option value="month">Monthly</option>
                    <option value="week">Weekly</option>
                </select>
            </div>
            <button class="btn-primary" onclick="generateTimeline()">Refresh Timeline</button>
        </div>
        
        <div class="timeline-container" id="timeline-container"></div>
    </div>
    
    <!-- Reading List Tab -->
    <div id="reading-tab" class="tab-content">
        <div class="controls-bar">
            <div class="control-group">
                <input type="text" id="search-reading" placeholder="Search papers..." style="width: 300px;">
            </div>
            <div class="control-group">
                <label>Status:</label>
                <select id="filter-reading-status">
                    <option value="all">All</option>
                    <option value="to-read">To Read</option>
                    <option value="reading">Reading</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
            <div class="control-group">
                <label>Type:</label>
                <select id="filter-reading-type">
                    <option value="all">All Types</option>
                    <option value="paper">Paper</option>
                    <option value="book">Book</option>
                    <option value="article">Article</option>
                    <option value="thesis">Thesis</option>
                </select>
            </div>
            <button class="btn-primary" onclick="showAddReadingModal()">+ Add Reading</button>
        </div>
        
        <div id="reading-container"></div>
    </div>
    
    <!-- Projects Tab -->
    <div id="projects-tab" class="tab-content">
        <div class="controls-bar">
            <button class="btn-primary" onclick="showAddProjectModal()">+ Add Project</button>
        </div>
        
        <div id="projects-container"></div>
    </div>
    
    <!-- Calendar Tab -->
    <div id="calendar-tab" class="tab-content">
        <div class="controls-bar">
            <div class="control-group">
                <button class="btn-secondary" onclick="changeMonth(-1)">← Previous</button>
                <h3 id="calendar-month" style="margin: 0 1rem;"></h3>
                <button class="btn-secondary" onclick="changeMonth(1)">Next →</button>
            </div>
        </div>
        
        <div class="calendar-grid" id="calendar-grid"></div>
    </div>
    
    <!-- Settings Tab -->
    <div id="settings-tab" class="tab-content">
        <div class="data-management">
            <h3>Data Management</h3>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn-success" onclick="exportAllData()">📥 Export All Data</button>
                <button class="btn-warning" onclick="importData()">📤 Import Data</button>
                <button class="btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
            </div>
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImport(event)">
        </div>
        
        <div class="task-card" style="margin-top: 2rem;">
            <h3>About</h3>
            <p>PhD Project Management System v1.0</p>
            <p>All data is stored locally in your browser.</p>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Task</h2>
                <button class="close-btn" onclick="closeModal('task-modal')">×</button>
            </div>
            <form id="task-form">
                <div class="form-group">
                    <label>Task Title</label>
                    <input type="text" id="task-title" required>
                </div>
                <div class="form-group">
                    <label>Project</label>
                    <select id="task-project" required>
                        <!-- Projects will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="task-priority">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="task-due-date">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="task-description"></textarea>
                </div>
                <div class="form-group">
                    <label>Subtasks (one per line)</label>
                    <textarea id="task-subtasks" placeholder="Enter subtasks, one per line"></textarea>
                </div>
                <button type="submit" class="btn-primary">Add Task</button>
            </form>
        </div>
    </div>
    
    <div id="reading-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Reading Material</h2>
                <button class="close-btn" onclick="closeModal('reading-modal')">×</button>
            </div>
            <form id="reading-form">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="reading-title" required>
                </div>
                <div class="form-group">
                    <label>Authors</label>
                    <input type="text" id="reading-authors">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="reading-type">
                        <option value="paper">Paper</option>
                        <option value="book">Book</option>
                        <option value="article">Article</option>
                        <option value="thesis">Thesis</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="text" id="reading-year">
                </div>
                <div class="form-group">
                    <label>URL/DOI</label>
                    <input type="url" id="reading-url">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="reading-notes"></textarea>
                </div>
                <button type="submit" class="btn-primary">Add Reading</button>
            </form>
        </div>
    </div>
    
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Project</h2>
                <button class="close-btn" onclick="closeModal('project-modal')">×</button>
            </div>
            <form id="project-form">
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text" id="project-name" required>
                </div>
                <div class="form-group">
                    <label>Short Code (e.g., A, B, C)</label>
                    <input type="text" id="project-code" maxlength="3" required>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="color" id="project-color" value="#3498db">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="project-description"></textarea>
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="project-start">
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="project-end">
                </div>
                <button type="submit" class="btn-primary">Add Project</button>
            </form>
        </div>
    </div>
    
    <script>
        // Data Structure
        let data = {
            projects: [
                {
                    id: 1,
                    name: "PhD Thesis",
                    code: "A",
                    color: "#3498db",
                    description: "Main PhD thesis work",
                    startDate: "2024-07-01",
                    endDate: "2024-09-30"
                },
                {
                    id: 2,
                    name: "Master's Thesis",
                    code: "B",
                    color: "#9b59b6",
                    description: "Master's thesis revision",
                    startDate: "2024-07-01",
                    endDate: "2024-08-30"
                },
                {
                    id: 3,
                    name: "GRC Poster",
                    code: "C",
                    color: "#e67e22",
                    description: "Gordon Research Conference poster",
                    startDate: "2024-07-01",
                    endDate: "2024-07-26"
                }
            ],
            tasks: [],
            readingList: [],
            currentMonth: new Date()
        };
        
        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('phdProjectData');
            if (saved) {
                data = JSON.parse(saved);
                data.currentMonth = new Date(data.currentMonth);
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('phdProjectData', JSON.stringify(data));
        }
        
        // Initialize
        function init() {
            loadData();
            updateDashboard();
            renderTasks();
            renderReadingList();
            renderProjects();
            generateTimeline();
            renderCalendar();
            setupEventListeners();
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Dashboard functions
        function updateDashboard() {
            const totalTasks = data.tasks.length;
            const completedTasks = data.tasks.filter(t => t.status === 'completed').length;
            const weekTasks = getThisWeekTasks().length;
            const readingComplete = data.readingList.filter(r => r.status === 'completed').length;
            const activeProjects = data.projects.filter(p => {
                const tasks = data.tasks.filter(t => t.projectId === p.id);
                return tasks.some(t => t.status !== 'completed');
            }).length;
            
            document.getElementById('stat-total').textContent = totalTasks;
            document.getElementById('stat-week').textContent = weekTasks;
            document.getElementById('stat-reading').textContent = readingComplete;
            document.getElementById('stat-projects').textContent = activeProjects;
            
            // Progress bar
            const progress = totalTasks > 0 ? (completedTasks / totalTasks * 100) : 0;
            document.getElementById('progress-total').style.width = `${progress}%`;
            
            // Overview
            const overview = document.getElementById('dashboard-overview');
            overview.innerHTML = `
                <p><strong>This Week:</strong> ${getThisWeekOverview()}</p>
                <p><strong>Overdue:</strong> ${getOverdueTasks().length} tasks</p>
                <p><strong>Recent Activity:</strong> ${getRecentActivity()}</p>
            `;
        }
        
        function getThisWeekTasks() {
            const today = new Date();
            const weekEnd = new Date(today);
            weekEnd.setDate(today.getDate() + 7);
            
            return data.tasks.filter(task => {
                if (!task.dueDate) return false;
                const taskDate = new Date(task.dueDate);
                return taskDate >= today && taskDate <= weekEnd;
            });
        }
        
        function getThisWeekOverview() {
            const weekTasks = getThisWeekTasks();
            const byProject = {};
            weekTasks.forEach(task => {
                const project = data.projects.find(p => p.id === task.projectId);
                if (project) {
                    byProject[project.name] = (byProject[project.name] || 0) + 1;
                }
            });
            return Object.entries(byProject).map(([name, count]) => `${count} ${name}`).join(', ') || 'No tasks scheduled';
        }
        
        function getOverdueTasks() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            return data.tasks.filter(task => {
                if (!task.dueDate || task.status === 'completed') return false;
                const taskDate = new Date(task.dueDate);
                return taskDate < today;
            });
        }
        
        function getRecentActivity() {
            const recent = data.tasks
                .filter(t => t.updatedAt)
                .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                .slice(0, 3);
            
            if (recent.length === 0) return 'No recent activity';
            return recent.map(t => t.title).join(', ');
        }
        
        // Task functions
        function renderTasks() {
            const container = document.getElementById('tasks-container');
            const searchTerm = document.getElementById('search-tasks').value.toLowerCase();
            const projectFilter = document.getElementById('filter-project').value;
            const statusFilter = document.getElementById('filter-status').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            
            let filteredTasks = data.tasks;
            
            // Apply filters
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(searchTerm) ||
                    task.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (projectFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.projectId === parseInt(projectFilter));
            }
            
            if (statusFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            if (priorityFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }
            
            // Sort by due date and priority
            filteredTasks.sort((a, b) => {
                if (a.status === 'completed' && b.status !== 'completed') return 1;
                if (a.status !== 'completed' && b.status === 'completed') return -1;
                if (a.dueDate && b.dueDate) {
                    return new Date(a.dueDate) - new Date(b.dueDate);
                }
                return 0;
            });
            
            container.innerHTML = filteredTasks.map(task => createTaskCard(task)).join('');
            
            // Update project filter options
            updateProjectFilter();
        }
        
        function createTaskCard(task) {
            const project = data.projects.find(p => p.id === task.projectId);
            const subtaskProgress = task.subtasks.filter(s => s.completed).length + '/' + task.subtasks.length;
            const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && task.status !== 'completed';
            
            return `
                <div class="task-card ${isOverdue ? 'overdue' : ''}">
                    <div class="task-header">
                        <div class="task-title editable" contenteditable="true" 
                             onblur="updateTaskTitle(${task.id}, this.textContent)">${task.title}</div>
                        <div class="task-meta">
                            ${project ? `<span class="badge badge-project" style="background: ${project.color}20; color: ${project.color}">${project.name}</span>` : ''}
                            <span class="badge badge-priority-${task.priority}">${task.priority.toUpperCase()}</span>
                            ${task.dueDate ? `<span class="badge">${formatDate(task.dueDate)}</span>` : ''}
                            <span class="status-badge status-${task.status}" onclick="cycleTaskStatus(${task.id})">
                                ${formatStatus(task.status)}
                            </span>
                            <button class="btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                    onclick="deleteTask(${task.id})">Delete</button>
                        </div>
                    </div>
                    ${task.description ? `<p class="editable" contenteditable="true" 
                        onblur="updateTaskDescription(${task.id}, this.textContent)">${task.description}</p>` : ''}
                    ${task.subtasks.length > 0 ? `
                        <div class="subtasks-container">
                            <strong>Subtasks (${subtaskProgress}):</strong>
                            ${task.subtasks.map(subtask => `
                                <div class="subtask-item">
                                    <input type="checkbox" ${subtask.completed ? 'checked' : ''} 
                                           onchange="toggleSubtask(${task.id}, ${subtask.id})">
                                    <span class="subtask-text ${subtask.completed ? 'completed' : ''} editable" 
                                          contenteditable="true" 
                                          onblur="updateSubtaskText(${task.id}, ${subtask.id}, this.textContent)">
                                        ${subtask.text}
                                    </span>
                                </div>
                            `).join('')}
                            <button class="btn-secondary" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                    onclick="addSubtask(${task.id})">+ Add Subtask</button>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function updateProjectFilter() {
            const select = document.getElementById('filter-project');
            const taskProjectSelect = document.getElementById('task-project');
            
            const projectOptions = '<option value="all">All Projects</option>' + 
                data.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            
            select.innerHTML = projectOptions;
            
            if (taskProjectSelect) {
                taskProjectSelect.innerHTML = data.projects.map(p => 
                    `<option value="${p.id}">${p.name}</option>`
                ).join('');
            }
        }
        
        function showAddTaskModal() {
            updateProjectFilter();
            document.getElementById('task-modal').classList.add('show');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function addTask(taskData) {
            const newTask = {
                id: Date.now(),
                ...taskData,
                status: 'not-started',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                subtasks: taskData.subtasks || []
            };
            
            data.tasks.push(newTask);
            saveData();
            renderTasks();
            updateDashboard();
        }
        
        function updateTaskTitle(id, title) {
            const task = data.tasks.find(t => t.id === id);
            if (task) {
                task.title = title;
                task.updatedAt = new Date().toISOString();
                saveData();
                updateDashboard();
            }
        }
        
        function updateTaskDescription(id, description) {
            const task = data.tasks.find(t => t.id === id);
            if (task) {
                task.description = description;
                task.updatedAt = new Date().toISOString();
                saveData();
            }
        }
        
        function cycleTaskStatus(id) {
            const statuses = ['not-started', 'in-progress', 'completed'];
            const task = data.tasks.find(t => t.id === id);
            if (task) {
                const currentIndex = statuses.indexOf(task.status);
                task.status = statuses[(currentIndex + 1) % statuses.length];
                task.updatedAt = new Date().toISOString();
                
                if (task.status === 'completed') {
                    task.subtasks.forEach(s => s.completed = true);
                }
                
                saveData();
                renderTasks();
                updateDashboard();
            }
        }
        
        function deleteTask(id) {
            if (confirm('Delete this task?')) {
                data.tasks = data.tasks.filter(t => t.id !== id);
                saveData();
                renderTasks();
                updateDashboard();
            }
        }
        
        function toggleSubtask(taskId, subtaskId) {
            const task = data.tasks.find(t => t.id === taskId);
            if (task) {
                const subtask = task.subtasks.find(s => s.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    task.updatedAt = new Date().toISOString();
                    
                    // Update task status based on subtasks
                    const allCompleted = task.subtasks.every(s => s.completed);
                    const someCompleted = task.subtasks.some(s => s.completed);
                    
                    if (allCompleted) {
                        task.status = 'completed';
                    } else if (someCompleted) {
                        task.status = 'in-progress';
                    }
                    
                    saveData();
                    renderTasks();
                    updateDashboard();
                }
            }
        }
        
        function updateSubtaskText(taskId, subtaskId, text) {
            const task = data.tasks.find(t => t.id === taskId);
            if (task) {
                const subtask = task.subtasks.find(s => s.id === subtaskId);
                if (subtask) {
                    subtask.text = text;
                    task.updatedAt = new Date().toISOString();
                    saveData();
                }
            }
        }
        
        function addSubtask(taskId) {
            const task = data.tasks.find(t => t.id === taskId);
            if (task) {
                const newSubtask = {
                    id: Date.now(),
                    text: 'New subtask - click to edit',
                    completed: false
                };
                task.subtasks.push(newSubtask);
                task.updatedAt = new Date().toISOString();
                saveData();
                renderTasks();
            }
        }
        
        // Reading List functions
        function renderReadingList() {
            const container = document.getElementById('reading-container');
            const searchTerm = document.getElementById('search-reading').value.toLowerCase();
            const statusFilter = document.getElementById('filter-reading-status').value;
            const typeFilter = document.getElementById('filter-reading-type').value;
            
            let filtered = data.readingList;
            
            if (searchTerm) {
                filtered = filtered.filter(item => 
                    item.title.toLowerCase().includes(searchTerm) ||
                    item.authors.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter !== 'all') {
                filtered = filtered.filter(item => item.status === statusFilter);
            }
            
            if (typeFilter !== 'all') {
                filtered = filtered.filter(item => item.type === typeFilter);
            }
            
            container.innerHTML = filtered.map(item => createReadingCard(item)).join('');
        }
        
        function createReadingCard(item) {
            const statusColors = {
                'to-read': '#e74c3c',
                'reading': '#f39c12',
                'completed': '#27ae60'
            };
            
            const statusIcons = {
                'to-read': '📚',
                'reading': '📖',
                'completed': '✓'
            };
            
            return `
                <div class="reading-item">
                    <div class="reading-status" style="background: ${statusColors[item.status]}" 
                         onclick="cycleReadingStatus(${item.id})">
                        ${statusIcons[item.status]}
                    </div>
                    <div class="reading-content">
                        <div class="reading-title">${item.title}</div>
                        <div class="reading-meta">
                            ${item.authors} ${item.year ? `(${item.year})` : ''}
                            <span class="badge" style="margin-left: 1rem;">${item.type.toUpperCase()}</span>
                        </div>
                        ${item.url ? `<a href="${item.url}" target="_blank" style="color: var(--primary);">View →</a>` : ''}
                        ${item.notes ? `<div style="margin-top: 0.5rem; color: #666;">${item.notes}</div>` : ''}
                    </div>
                    <button class="btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                            onclick="deleteReading(${item.id})">Delete</button>
                </div>
            `;
        }
        
        function showAddReadingModal() {
            document.getElementById('reading-modal').classList.add('show');
        }
        
        function cycleReadingStatus(id) {
            const statuses = ['to-read', 'reading', 'completed'];
            const item = data.readingList.find(r => r.id === id);
            if (item) {
                const currentIndex = statuses.indexOf(item.status);
                item.status = statuses[(currentIndex + 1) % statuses.length];
                saveData();
                renderReadingList();
                updateDashboard();
            }
        }
        
        function deleteReading(id) {
            if (confirm('Delete this reading item?')) {
                data.readingList = data.readingList.filter(r => r.id !== id);
                saveData();
                renderReadingList();
                updateDashboard();
            }
        }
        
        // Project functions
        function renderProjects() {
            const container = document.getElementById('projects-container');
            
            container.innerHTML = data.projects.map(project => {
                const tasks = data.tasks.filter(t => t.projectId === project.id);
                const completed = tasks.filter(t => t.status === 'completed').length;
                const progress = tasks.length > 0 ? (completed / tasks.length * 100) : 0;
                
                return `
                    <div class="task-card">
                        <div class="task-header">
                            <div class="task-title">
                                <span style="display: inline-block; width: 30px; height: 30px; background: ${project.color}; 
                                           border-radius: 6px; vertical-align: middle; margin-right: 1rem;"></span>
                                ${project.name} (${project.code})
                            </div>
                            <button class="btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                    onclick="deleteProject(${project.id})">Delete</button>
                        </div>
                        <p>${project.description}</p>
                        <div class="task-meta">
                            <span class="badge">Tasks: ${tasks.length}</span>
                            <span class="badge">Completed: ${completed}</span>
                            <span class="badge">${project.startDate} - ${project.endDate}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showAddProjectModal() {
            document.getElementById('project-modal').classList.add('show');
        }
        
        function deleteProject(id) {
            const hasTasks = data.tasks.some(t => t.projectId === id);
            if (hasTasks) {
                alert('Cannot delete project with existing tasks. Please delete or reassign tasks first.');
                return;
            }
            
            if (confirm('Delete this project?')) {
                data.projects = data.projects.filter(p => p.id !== id);
                saveData();
                renderProjects();
                updateDashboard();
            }
        }
        
        // Timeline functions
        function generateTimeline() {
            const container = document.getElementById('timeline-container');
            const view = document.getElementById('timeline-view').value;
            
            // Group tasks by week
            const weeks = {};
            data.tasks.forEach(task => {
                if (!task.dueDate) return;
                const weekKey = getWeekKey(new Date(task.dueDate));
                if (!weeks[weekKey]) weeks[weekKey] = [];
                weeks[weekKey].push(task);
            });
            
            // Create timeline header
            let html = '<div class="timeline-header"><div>Project</div>';
            const startDate = new Date('2024-07-01');
            const endDate = new Date('2024-09-30');
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 7)) {
                html += `<div>Week ${getWeekNumber(d)}</div>`;
            }
            html += '</div>';
            
            // Create timeline rows for each project
            data.projects.forEach(project => {
                html += `<div class="timeline-row">`;
                html += `<div style="font-weight: 600;">${project.name}</div>`;
                
                for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 7)) {
                    const weekKey = getWeekKey(d);
                    const weekTasks = (weeks[weekKey] || []).filter(t => t.projectId === project.id);
                    
                    if (weekTasks.length > 0) {
                        const completed = weekTasks.filter(t => t.status === 'completed').length;
                        const className = completed === weekTasks.length ? 'timeline-completed' : 'timeline-active';
                        html += `<div class="timeline-cell ${className}">${weekTasks.length} tasks</div>`;
                    } else {
                        html += `<div class="timeline-cell">-</div>`;
                    }
                }
                
                html += '</div>';
            });
            
            container.innerHTML = html;
        }
        
        function getWeekKey(date) {
            const year = date.getFullYear();
            const week = getWeekNumber(date);
            return `${year}-W${week}`;
        }
        
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }
        
        // Calendar functions
        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthDisplay = document.getElementById('calendar-month');
            
            const year = data.currentMonth.getFullYear();
            const month = data.currentMonth.getMonth();
            
            monthDisplay.textContent = data.currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            // Days of week headers
            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            let html = daysOfWeek.map(day => `<div class="calendar-header">${day}</div>`).join('');
            
            // Calculate first day and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-cell"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const dayTasks = data.tasks.filter(t => t.dueDate === dateStr);
                
                html += `<div class="calendar-cell">
                    <div class="calendar-day">${day}</div>
                    ${dayTasks.map(task => {
                        const project = data.projects.find(p => p.id === task.projectId);
                        return `<div class="calendar-task" style="background: ${project?.color}30; color: ${project?.color}" 
                                     onclick="alert('${task.title}')">${task.title.substring(0, 20)}...</div>`;
                    }).join('')}
                </div>`;
            }
            
            grid.innerHTML = html;
        }
        
        function changeMonth(direction) {
            data.currentMonth.setMonth(data.currentMonth.getMonth() + direction);
            renderCalendar();
        }
        
        // Settings functions
        function exportAllData() {
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `phd-project-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importData() {
            document.getElementById('import-file').click();
        }
        
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    data = imported;
                    data.currentMonth = new Date(data.currentMonth);
                    saveData();
                    location.reload();
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        function clearAllData() {
            if (confirm('This will delete ALL your data. Are you sure?')) {
                if (confirm('This action cannot be undone. Continue?')) {
                    localStorage.removeItem('phdProjectData');
                    location.reload();
                }
            }
        }
        
        // Utility functions
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        function formatStatus(status) {
            return status.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }
        
        function resetFilters() {
            document.getElementById('search-tasks').value = '';
            document.getElementById('filter-project').value = 'all';
            document.getElementById('filter-status').value = 'all';
            document.getElementById('filter-priority').value = 'all';
            renderTasks();
        }
        
        // Event Listeners
        function setupEventListeners() {
            // Task form
            document.getElementById('task-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const subtasksText = document.getElementById('task-subtasks').value;
                const subtasks = subtasksText.split('\n').filter(s => s.trim()).map(text => ({
                    id: Date.now() + Math.random(),
                    text: text.trim(),
                    completed: false
                }));
                
                addTask({
                    title: document.getElementById('task-title').value,
                    projectId: parseInt(document.getElementById('task-project').value),
                    priority: document.getElementById('task-priority').value,
                    dueDate: document.getElementById('task-due-date').value,
                    description: document.getElementById('task-description').value,
                    subtasks: subtasks
                });
                
                closeModal('task-modal');
                e.target.reset();
            });
            
            // Reading form
            document.getElementById('reading-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                data.readingList.push({
                    id: Date.now(),
                    title: document.getElementById('reading-title').value,
                    authors: document.getElementById('reading-authors').value,
                    type: document.getElementById('reading-type').value,
                    year: document.getElementById('reading-year').value,
                    url: document.getElementById('reading-url').value,
                    notes: document.getElementById('reading-notes').value,
                    status: 'to-read'
                });
                
                saveData();
                renderReadingList();
                updateDashboard();
                closeModal('reading-modal');
                e.target.reset();
            });
            
            // Project form
            document.getElementById('project-form').addEventListener('submit', (e) => {
                e.preventDefault();
                
                data.projects.push({
                    id: Date.now(),
                    name: document.getElementById('project-name').value,
                    code: document.getElementById('project-code').value,
                    color: document.getElementById('project-color').value,
                    description: document.getElementById('project-description').value,
                    startDate: document.getElementById('project-start').value,
                    endDate: document.getElementById('project-end').value
                });
                
                saveData();
                renderProjects();
                updateProjectFilter();
                closeModal('project-modal');
                e.target.reset();
            });
            
            // Search and filter listeners
            document.getElementById('search-tasks').addEventListener('input', renderTasks);
            document.getElementById('filter-project').addEventListener('change', renderTasks);
            document.getElementById('filter-status').addEventListener('change', renderTasks);
            document.getElementById('filter-priority').addEventListener('change', renderTasks);
            
            document.getElementById('search-reading').addEventListener('input', renderReadingList);
            document.getElementById('filter-reading-status').addEventListener('change', renderReadingList);
            document.getElementById('filter-reading-type').addEventListener('change', renderReadingList);
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });
        }
        
        // Initialize everything
        init();
    </script>
</body>
</html>
